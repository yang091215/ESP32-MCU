#include <Arduino.h>
#include <WiFi.h>
#include <DHT.h>

// ==== å®šä¹‰å¼•è„š ====
#define SOIL_PIN 34         // åœŸå£¤æ¹¿åº¦æ¨¡æ‹Ÿè¾“å…¥ï¼ˆADCï¼‰
#define DHT_PIN 10          // æ¸©æ¹¿åº¦ä¼ æ„Ÿå™¨è¾“å…¥å¼•è„š
#define DHT_TYPE DHT22      // DHT11 æˆ– DHT22

// ==== WiFi é…ç½® ====
const char* ssid = "ä½ çš„WiFiåç§°";
const char* password = "ä½ çš„WiFiå¯†ç ";

DHT dht(DHT_PIN, DHT_TYPE);

void connectToWiFi() {
  Serial.print("è¿æ¥åˆ°WiFiä¸­: ");
  WiFi.begin(ssid, password);

  int retries = 0;
  while (WiFi.status() != WL_CONNECTED && retries < 20) {
    delay(500);
    Serial.print(".");
    retries++;
  }

  if (WiFi.status() == WL_CONNECTED) {
    Serial.println("\nWiFi è¿æ¥æˆåŠŸï¼");
    Serial.print("IP åœ°å€: ");
    Serial.println(WiFi.localIP());
  } else {
    Serial.println("\nWiFi è¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥SSIDå’Œå¯†ç ã€‚");
  }
}

void setup() {
  Serial.begin(115200);
  analogReadResolution(12);  // è®¾ç½®ä¸º12ä½ ADC
  dht.begin();               // å¯åŠ¨æ¸©æ¹¿åº¦ä¼ æ„Ÿå™¨

  connectToWiFi();
}

void loop() {
  // è¯»å–åœŸå£¤æ¹¿åº¦
  int soilValue = analogRead(SOIL_PIN);
  float voltage = soilValue * 3.3 / 4095.0;

  // è¯»å–æ¸©æ¹¿åº¦
  float temperature = dht.readTemperature();  // æ‘„æ°æ¸©åº¦
  float humidity = dht.readHumidity();

  // æ‰“å°æ‰€æœ‰æ•°æ®
  Serial.print("æ¹¿åº¦å€¼: ");
  Serial.print(soilValue);
  Serial.print(" -> ");
  Serial.print(voltage, 2);
  Serial.print("V | ");

  if (soilValue > 3000) {
    Serial.print("Very Dry ğŸŒµ | ");
  } else if (soilValue > 2000) {
    Serial.print("Normal ğŸ’§ | ");
  } else {
    Serial.print("Very Wet ğŸŒŠ | ");
  }

  if (isnan(temperature) || isnan(humidity)) {
    Serial.println("æ¸©æ¹¿åº¦è¯»å–å¤±è´¥ ğŸ˜¢");
  } else {
    Serial.print("æ¸©åº¦: ");
    Serial.print(temperature);
    Serial.print("Â°C | æ¹¿åº¦: ");
    Serial.print(humidity);
    Serial.println("%");
  }

  delay(3000);
}
